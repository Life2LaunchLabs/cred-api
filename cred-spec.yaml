openapi: 3.1.0
info:
  title: Badging App API (v0)
  version: 0.2.1
  description: >
    v0 OpenAPI spec for org/staff/learner/badge/collection management with JWT auth + RBAC.
    Auth is enforced by required permissions (vendor extension `x-permissions`) and org-scope checks.

servers:
  - url: https://api.example.com

tags:
  - name: Auth
    description: User registration, login, token refresh, and logout.
  - name: Orgs
    description: Organization CRUD and settings management.
  - name: Org Members
    description: Staff membership within an organization.
  - name: Org Learners
    description: Learners affiliated with an organization.
  - name: Cohorts
    description: Groups of learners within an organization.
  - name: Programs
    description: Program templates with phases, badges, and checkpoints.
  - name: Program Assignments
    description: Assigning programs to cohorts and learners with progress tracking.
  - name: Users
    description: Platform-wide user profiles and settings.
  - name: Badges
    description: Badge definitions, criteria, and lifecycle.
  - name: Collections
    description: Curated groups of badges.
  - name: Registry
    description: Public registry of published collections.
  - name: Requests
    description: Membership and issue-authorization request workflows.
  - name: Issuances
    description: Badge issuance and revocation.
  - name: Public
    description: Unauthenticated public verification endpoints.
  - name: Reporting
    description: Aggregated statistics and analytics for organizations.

security:
  - bearerAuth: []

paths:
  /auth/register:
    post:
      operationId: register
      tags: [Auth]
      summary: Register a user account
      description: Creates a new user account and returns JWT tokens. Email must be unique.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/RegisterRequest" }
      responses:
        "201":
          description: Account created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/AuthResponse" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "409":
          description: Email already registered
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /auth/login:
    post:
      operationId: login
      tags: [Auth]
      summary: Login and receive JWT access token
      description: Authenticates a user by email and password, returning JWT tokens.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/LoginRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/AuthResponse" }
        "401":
          description: Invalid credentials
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /auth/refresh:
    post:
      operationId: refreshToken
      tags: [Auth]
      summary: Refresh access token
      description: Exchanges a valid refresh token for a new access/refresh token pair.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/RefreshRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/AuthResponse" }
        "401":
          description: Invalid or expired refresh token
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /auth/logout:
    post:
      operationId: logout
      tags: [Auth]
      summary: Logout (invalidate refresh token / session)
      description: Invalidates the current session and refresh token.
      responses:
        "204": { description: No Content }
        "401": { $ref: "#/components/responses/Unauthorized" }

  /auth/createorg:
    post:
      operationId: createOrg
      tags: [Auth, Orgs]
      summary: Create a new organization
      description: Creates a new organization. The authenticated user becomes the owner.
      x-permissions: ["org:create"]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/OrgCreateRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Org" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }

  /orgs:
    get:
      operationId: listOrgs
      tags: [Orgs]
      summary: List organizations (platform-wide)
      description: Super admin only. Returns a paginated list of all organizations on the platform.
      x-permissions: ["platform:orgs:read"]
      parameters:
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
        - $ref: "#/components/parameters/Query"
        - name: filter
          in: query
          schema:
            type: object
            additionalProperties: true
          style: deepObject
          explode: true
          description: Optional structured filter (implementation-defined).
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PagedOrgs" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }

  /orgs/{orgId}:
    get:
      operationId: getOrg
      tags: [Orgs]
      summary: Get org details
      description: Returns the details of a single organization.
      x-permissions: ["org:read"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Org" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
    patch:
      operationId: updateOrg
      tags: [Orgs]
      summary: Update org details
      description: Partially updates an organization's profile fields.
      x-permissions: ["org:manage"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/OrgUpdateRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Org" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/settings:
    get:
      operationId: getOrgSettings
      tags: [Orgs]
      summary: Read org settings
      description: Returns the settings for an organization (join policies, default roles, etc.).
      x-permissions: ["org:manage"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/OrgSettings" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
    patch:
      operationId: updateOrgSettings
      tags: [Orgs]
      summary: Update org settings
      description: Partially updates the organization's settings.
      x-permissions: ["org:manage"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/OrgSettingsUpdateRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/OrgSettings" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/stats:
    get:
      operationId: getOrgStats
      tags: [Orgs, Reporting]
      summary: Get org statistics
      description: Returns aggregated statistics for the organization (member counts, badge counts, issuance counts).
      x-permissions: ["org:read"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/OrgStats" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/members:
    get:
      operationId: listOrgMembers
      tags: [Org Members]
      summary: List org members (staff)
      description: Returns a paginated list of staff members for the organization, including nested user profiles.
      x-permissions: ["org:members:read"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
        - $ref: "#/components/parameters/Query"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PagedOrgMemberDetails" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/members/{memberId}:
    get:
      operationId: getOrgMember
      tags: [Org Members]
      summary: Get membership record (role, status)
      description: Returns the membership details for a specific staff member.
      x-permissions: ["org:members:read"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/MemberId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/OrgMember" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
    patch:
      operationId: updateOrgMember
      tags: [Org Members]
      summary: Update membership record (e.g., role/admin)
      description: Updates a member's role or status within the organization.
      x-permissions: ["org:members:manage"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/MemberId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/OrgMemberUpdateRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/OrgMember" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/membership-requests:
    post:
      operationId: createMembershipRequest
      tags: [Requests]
      summary: Request to join org (or admin invite)
      description: Submits a request for a user to join an organization, or an admin invite on behalf of a user.
      x-permissions: ["org:membership:request"]
      parameters:
        - $ref: "#/components/parameters/OrgId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/MembershipRequestCreate" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/MembershipRequest" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "409":
          description: A pending request already exists for this user and org
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
    get:
      operationId: listMembershipRequests
      tags: [Requests]
      summary: List membership requests for org (admin review)
      description: Returns pending, approved, and rejected membership requests for admin review.
      x-permissions: ["org:members:manage"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PagedMembershipRequests" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/membership-requests/{requestId}/approve:
    post:
      operationId: approveMembershipRequest
      tags: [Requests]
      summary: Approve membership request
      description: Approves a pending membership request, creating the org member record.
      x-permissions: ["org:members:manage"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/RequestId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/OrgMember" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/membership-requests/{requestId}/reject:
    post:
      operationId: rejectMembershipRequest
      tags: [Requests]
      summary: Reject membership request
      description: Rejects a pending membership request.
      x-permissions: ["org:members:manage"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/RequestId"
      responses:
        "204": { description: No Content }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/learners:
    get:
      operationId: listOrgLearners
      tags: [Org Learners]
      summary: List learners affiliated with org
      description: Returns a paginated list of learners provisioned in this organization.
      x-permissions: ["org:learners:read"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
        - $ref: "#/components/parameters/Query"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PagedOrgLearners" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
    post:
      operationId: createOrgLearner
      tags: [Org Learners]
      summary: Provision a learner in this org
      description: Creates a new learner record affiliated with this organization.
      x-permissions: ["org:learners:manage"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/OrgLearnerCreateRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/OrgLearner" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/learners:bulk-import:
    post:
      operationId: bulkImportOrgLearners
      tags: [Org Learners]
      summary: Bulk import learners for org
      description: Accepts a batch of learner records and queues them for import.
      x-permissions: ["org:learners:manage"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/BulkLearnerImportRequest" }
      responses:
        "202":
          description: Accepted
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ImportJob" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/learners/{learnerId}:
    get:
      operationId: getOrgLearner
      tags: [Org Learners]
      summary: Get learner details as it pertains to this org
      description: Returns learner details including badge progress and issuances scoped to this organization.
      x-permissions: ["org:learners:read"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/LearnerId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/OrgLearnerDetail" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/learners/{learnerId}/badges/{badgeId}:
    get:
      operationId: getOrgLearnerBadgeProgress
      tags: [Org Learners, Badges]
      summary: Get learner progress toward badge (org-scoped)
      description: Returns the learner's progress on a specific badge within this organization.
      x-permissions: ["org:badges:track"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/LearnerId"
        - $ref: "#/components/parameters/BadgeId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/BadgeProgress" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
    patch:
      operationId: updateOrgLearnerBadgeProgress
      tags: [Org Learners, Badges]
      summary: Update learner progress toward badge (org-scoped)
      description: Updates the learner's progress on a badge, such as marking criteria complete.
      x-permissions: ["org:badges:track"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/LearnerId"
        - $ref: "#/components/parameters/BadgeId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/BadgeProgressUpdateRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/BadgeProgress" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/issuances:
    post:
      operationId: createIssuance
      tags: [Issuances]
      summary: Issue a badge to a learner (creates Assertion)
      description: Issues a badge to a learner, creating a verifiable assertion record.
      x-permissions: ["org:badges:issue"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/IssuanceCreateRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Issuance" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
    get:
      operationId: listIssuances
      tags: [Issuances]
      summary: List issuances for org
      description: Returns a paginated list of badge issuances for this organization, with optional filters.
      x-permissions: ["org:badges:read"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
        - name: learnerId
          in: query
          schema: { type: string }
          description: Filter issuances by learner.
        - name: badgeId
          in: query
          schema: { type: string }
          description: Filter issuances by badge.
        - name: status
          in: query
          schema: { type: string, enum: [issued, revoked] }
          description: Filter by issuance status.
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PagedIssuances" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/cohorts:
    get:
      operationId: listCohorts
      tags: [Cohorts]
      summary: List cohorts
      description: Returns a paginated list of cohorts for this organization.
      x-permissions: ["org:cohorts:read"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
        - $ref: "#/components/parameters/Query"
        - name: status
          in: query
          schema:
            type: string
            enum: [active, draft, archived]
          description: Filter by cohort status.
        - name: staffId
          in: query
          schema: { type: string }
          description: Filter cohorts where this member is assigned.
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PagedCohorts" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
    post:
      operationId: createCohort
      tags: [Cohorts]
      summary: Create cohort
      description: Creates a new learner cohort within the organization.
      x-permissions: ["org:cohorts:manage"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CohortCreateRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Cohort" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/cohorts/{cohortId}:
    get:
      operationId: getCohort
      tags: [Cohorts]
      summary: Get cohort details (including learner constituents)
      description: Returns full cohort details including the list of learners in this cohort.
      x-permissions: ["org:cohorts:read"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/CohortId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CohortDetail" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
    patch:
      operationId: updateCohort
      tags: [Cohorts]
      summary: Update cohort
      description: Partially updates a cohort's name or description.
      x-permissions: ["org:cohorts:manage"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/CohortId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CohortUpdateRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Cohort" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
    delete:
      operationId: deleteCohort
      tags: [Cohorts]
      summary: Delete cohort
      description: Permanently deletes a cohort. Learners are not removed from the organization.
      x-permissions: ["org:cohorts:manage"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/CohortId"
      responses:
        "204": { description: No Content }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/cohorts/{cohortId}/learners:
    post:
      operationId: addCohortLearners
      tags: [Cohorts]
      summary: Add learners to cohort (batch)
      description: Adds one or more learners to a cohort by their IDs.
      x-permissions: ["org:cohorts:manage"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/CohortId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CohortLearnersAddRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CohortDetail" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/cohorts/{cohortId}/learners/{learnerId}:
    delete:
      operationId: removeCohortLearner
      tags: [Cohorts]
      summary: Remove learner from cohort
      description: Removes a single learner from a cohort.
      x-permissions: ["org:cohorts:manage"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/CohortId"
        - $ref: "#/components/parameters/LearnerId"
      responses:
        "204": { description: No Content }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  # ---------- Programs ----------
  /orgs/{orgId}/programs:
    get:
      operationId: listPrograms
      tags: [Programs]
      summary: List programs for an organization
      description: Returns programs filtered by status.
      x-permissions: ["org:programs:read"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - name: status
          in: query
          description: Filter by program status.
          schema:
            type: string
            enum: [draft, active, archived]
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PagedPrograms" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }

    post:
      operationId: createProgram
      tags: [Programs]
      summary: Create a new program
      description: Creates a program template with phases.
      x-permissions: ["org:programs:write"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/ProgramCreateRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ProgramDetail" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }

  /orgs/{orgId}/programs/{programSlug}:
    get:
      operationId: getProgram
      tags: [Programs]
      summary: Get program details
      description: Returns program with full phase details.
      x-permissions: ["org:programs:read"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/ProgramSlug"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ProgramDetail" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

    patch:
      operationId: updateProgram
      tags: [Programs]
      summary: Update program
      description: Partially updates program details and/or phases.
      x-permissions: ["org:programs:write"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/ProgramSlug"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/ProgramUpdateRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ProgramDetail" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

    delete:
      operationId: deleteProgram
      tags: [Programs]
      summary: Delete program
      description: Deletes a program if it has no active assignments.
      x-permissions: ["org:programs:write"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/ProgramSlug"
      responses:
        "204": { description: No Content }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
        "409":
          description: Cannot delete program with active assignments
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ---------- Cohort Program Assignments ----------
  /orgs/{orgId}/cohorts/{cohortId}/program-assignments:
    get:
      operationId: listCohortProgramAssignments
      tags: [Program Assignments]
      summary: List program assignments for a cohort
      description: Returns all programs assigned to a cohort.
      x-permissions: ["org:programs:read"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/CohortId"
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PagedCohortProgramAssignments" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

    post:
      operationId: assignProgramToCohort
      tags: [Program Assignments]
      summary: Assign program to cohort
      description: Assigns a program to a cohort, auto-creating learner assignments.
      x-permissions: ["org:programs:assign"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/CohortId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CohortProgramAssignmentCreateRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CohortProgramAssignmentDetail" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/cohorts/{cohortId}/program-assignments/{cohortAssignmentId}:
    get:
      operationId: getCohortProgramAssignment
      tags: [Program Assignments]
      summary: Get cohort program assignment details
      description: Returns assignment with aggregate progress.
      x-permissions: ["org:programs:read"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/CohortId"
        - $ref: "#/components/parameters/CohortAssignmentId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CohortProgramAssignmentDetail" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

    delete:
      operationId: unassignProgramFromCohort
      tags: [Program Assignments]
      summary: Remove program assignment from cohort
      description: Removes assignment and all derived learner assignments.
      x-permissions: ["org:programs:assign"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/CohortId"
        - $ref: "#/components/parameters/CohortAssignmentId"
      responses:
        "204": { description: No Content }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  # ---------- Learner Program Assignments ----------
  /orgs/{orgId}/learners/{learnerId}/program-assignments:
    get:
      operationId: listLearnerProgramAssignments
      tags: [Program Assignments]
      summary: List program assignments for a learner
      description: Returns all programs assigned to a learner.
      x-permissions: ["org:programs:read"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/LearnerId"
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PagedLearnerProgramAssignments" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

    post:
      operationId: assignProgramToLearner
      tags: [Program Assignments]
      summary: Assign program to learner
      description: Directly assigns a program to a learner.
      x-permissions: ["org:programs:assign"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/LearnerId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/LearnerProgramAssignmentCreateRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/LearnerProgramAssignmentDetail" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /orgs/{orgId}/learners/{learnerId}/program-assignments/{learnerAssignmentId}:
    get:
      operationId: getLearnerProgramAssignment
      tags: [Program Assignments]
      summary: Get learner program assignment details
      description: Returns assignment with full progress tracking.
      x-permissions: ["org:programs:read"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/LearnerId"
        - $ref: "#/components/parameters/LearnerAssignmentId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/LearnerProgramAssignmentDetail" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

    delete:
      operationId: unassignProgramFromLearner
      tags: [Program Assignments]
      summary: Remove program assignment from learner
      description: Removes assignment (only if not cohort-derived).
      x-permissions: ["org:programs:assign"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/LearnerId"
        - $ref: "#/components/parameters/LearnerAssignmentId"
      responses:
        "204": { description: No Content }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
        "409":
          description: Cannot remove cohort-derived assignment
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  # ---------- Checkpoint Completions ----------
  /orgs/{orgId}/learners/{learnerId}/program-assignments/{learnerAssignmentId}/checkpoints/{checkpointId}/sign:
    post:
      operationId: signCheckpoint
      tags: [Program Assignments]
      summary: Sign off on a checkpoint
      description: Staff marks a checkpoint as complete for a learner.
      x-permissions: ["org:programs:sign"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/LearnerId"
        - $ref: "#/components/parameters/LearnerAssignmentId"
        - name: checkpointId
          in: path
          required: true
          schema: { type: string, example: "chk_abc123" }
      requestBody:
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CheckpointSignRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CheckpointCompletion" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
        "409":
          description: Checkpoint already signed
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }

  /orgs/{orgId}/learners/{learnerId}/program-assignments/{learnerAssignmentId}/checkpoints/{checkpointId}/unsign/{completionId}:
    delete:
      operationId: unsignCheckpoint
      tags: [Program Assignments]
      summary: Remove checkpoint signature
      description: Staff revokes a checkpoint completion.
      x-permissions: ["org:programs:sign"]
      x-org-scope: "{orgId}"
      parameters:
        - $ref: "#/components/parameters/OrgId"
        - $ref: "#/components/parameters/LearnerId"
        - $ref: "#/components/parameters/LearnerAssignmentId"
        - name: checkpointId
          in: path
          required: true
          schema: { type: string, example: "chk_abc123" }
        - $ref: "#/components/parameters/CheckpointCompletionId"
      responses:
        "204": { description: No Content }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /users:
    get:
      operationId: listUsers
      tags: [Users]
      summary: List users (platform-wide)
      description: Super admin only. Returns a paginated list of all user accounts.
      x-permissions: ["platform:users:read"]
      parameters:
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
        - $ref: "#/components/parameters/Query"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PagedUsers" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }

  /users/{userId}:
    get:
      operationId: getUser
      tags: [Users]
      summary: Get user details (profile)
      description: Returns the user's profile information.
      x-permissions: ["user:read"]
      parameters:
        - $ref: "#/components/parameters/UserId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/User" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /users/{userId}/settings:
    get:
      operationId: getUserSettings
      tags: [Users]
      summary: Get user settings
      description: Returns the user's preferences (locale, marketing opt-in, etc.).
      x-permissions: ["user:settings:read"]
      parameters:
        - $ref: "#/components/parameters/UserId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/UserSettings" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
    patch:
      operationId: updateUserSettings
      tags: [Users]
      summary: Update user settings
      description: Partially updates the user's preferences.
      x-permissions: ["user:settings:write"]
      parameters:
        - $ref: "#/components/parameters/UserId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/UserSettingsUpdateRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/UserSettings" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /users/{userId}/orgs:
    get:
      operationId: listUserOrgs
      tags: [Users, Orgs]
      summary: List orgs the user belongs to
      description: Returns the organizations the user is a member of, together with their membership record (role, status).
      x-permissions: ["user:orgs:read"]
      parameters:
        - $ref: "#/components/parameters/UserId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items: { $ref: "#/components/schemas/UserOrgMembership" }
                required: [data]
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /learners:
    get:
      operationId: listLearners
      tags: [Org Learners]
      summary: List learners (platform-wide)
      description: Super admin only. Returns a paginated list of all learner records.
      x-permissions: ["platform:learners:read"]
      parameters:
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
        - $ref: "#/components/parameters/Query"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PagedLearners" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }

  /learners/{learnerId}:
    get:
      operationId: getLearner
      tags: [Org Learners]
      summary: Get learner details (global)
      description: Returns a learner's global profile, independent of any organization.
      x-permissions: ["learner:read"]
      parameters:
        - $ref: "#/components/parameters/LearnerId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Learner" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /learners/{learnerId}/badges:
    get:
      operationId: listLearnerBadges
      tags: [Badges]
      summary: List badges earned or in progress (global aggregation)
      description: Returns a paginated list of all badges a learner has earned or is working toward across all orgs.
      x-permissions: ["learner:badges:read"]
      parameters:
        - $ref: "#/components/parameters/LearnerId"
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PagedLearnerBadges" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /learners/{learnerId}/badges/{badgeId}:
    get:
      operationId: getLearnerBadgeJourney
      tags: [Badges]
      summary: Learner journey for a specific badge
      description: Returns the learner's full journey for a badge  progress across orgs, and any assertions earned. Used for shareable certificate pages.
      x-permissions: ["learner:badges:read"]
      parameters:
        - $ref: "#/components/parameters/LearnerId"
        - $ref: "#/components/parameters/BadgeId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/LearnerBadgeJourney" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /badges:
    get:
      operationId: listBadges
      tags: [Badges]
      summary: List badges
      description: Returns a paginated list of badge definitions, optionally filtered by creating org.
      x-permissions: ["badges:read"]
      parameters:
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
        - $ref: "#/components/parameters/Query"
        - name: orgId
          in: query
          schema: { type: string }
          description: Filter badges by creator org.
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PagedBadges" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
    post:
      operationId: createBadge
      tags: [Badges]
      summary: Create a badge
      description: Creates a new badge definition with optional criteria.
      x-permissions: ["badges:create"]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/BadgeCreateRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Badge" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }

  /badges/{badgeId}:
    get:
      operationId: getBadge
      tags: [Badges]
      summary: Get badge details (Open Badges-aligned)
      description: Returns the full badge definition including criteria.
      x-permissions: ["badges:read"]
      parameters:
        - $ref: "#/components/parameters/BadgeId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Badge" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
    patch:
      operationId: updateBadge
      tags: [Badges]
      summary: Update badge
      description: Partially updates a badge's name, description, image, or criteria.
      x-permissions: ["badges:update"]
      parameters:
        - $ref: "#/components/parameters/BadgeId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/BadgeUpdateRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Badge" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
    delete:
      operationId: deleteBadge
      tags: [Badges]
      summary: Delete badge
      description: Permanently deletes a badge definition. Existing issuances are not affected.
      x-permissions: ["badges:delete"]
      parameters:
        - $ref: "#/components/parameters/BadgeId"
      responses:
        "204": { description: No Content }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /collections:
    get:
      operationId: listCollections
      tags: [Collections]
      summary: List collections
      description: Returns a paginated list of badge collections.
      x-permissions: ["collections:read"]
      parameters:
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
        - $ref: "#/components/parameters/Query"
        - name: orgId
          in: query
          schema: { type: string }
          description: Filter collections accessible to this org (created by or authorized for).
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PagedCollections" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
    post:
      operationId: createCollection
      tags: [Collections]
      summary: Create collection
      description: Creates a new collection of badges.
      x-permissions: ["collections:create"]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CollectionCreateRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Collection" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }

  /collections/{collectionId}:
    get:
      operationId: getCollection
      tags: [Collections]
      summary: Get collection details (includes some badge details)
      description: Returns the collection and summaries of the badges it contains.
      x-permissions: ["collections:read"]
      parameters:
        - $ref: "#/components/parameters/CollectionId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CollectionDetail" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
    patch:
      operationId: updateCollection
      tags: [Collections]
      summary: Update collection (including add/remove badges)
      description: Partially updates a collection's metadata and/or its badge membership.
      x-permissions: ["collections:update"]
      parameters:
        - $ref: "#/components/parameters/CollectionId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CollectionUpdateRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CollectionDetail" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
    delete:
      operationId: deleteCollection
      tags: [Collections]
      summary: Delete collection
      description: Permanently deletes a collection. Badges within it are not deleted.
      x-permissions: ["collections:delete"]
      parameters:
        - $ref: "#/components/parameters/CollectionId"
      responses:
        "204": { description: No Content }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /registry/collections:
    get:
      operationId: browseRegistry
      tags: [Registry]
      summary: Browse published collections in registry
      description: Public browsing of published collections. No authentication required.
      security: []
      parameters:
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
        - $ref: "#/components/parameters/Query"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PagedCollections" }

  /collections/{collectionId}/publish:
    post:
      operationId: publishCollection
      tags: [Registry]
      summary: Publish a collection to registry
      description: Makes a collection visible in the public registry.
      x-permissions: ["collections:publish"]
      parameters:
        - $ref: "#/components/parameters/CollectionId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CollectionDetail" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /collections/{collectionId}/unpublish:
    post:
      operationId: unpublishCollection
      tags: [Registry]
      summary: Unpublish a collection from registry
      description: Removes a collection from the public registry.
      x-permissions: ["collections:publish"]
      parameters:
        - $ref: "#/components/parameters/CollectionId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CollectionDetail" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /collections/{collectionId}/issue-authorizations:
    post:
      operationId: requestIssueAuthorization
      tags: [Requests]
      summary: Request authorization for an org to issue a collection
      description: An org requests permission from the collection creator to issue its badges.
      x-permissions: ["org:issue-auth:request"]
      parameters:
        - $ref: "#/components/parameters/CollectionId"
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/IssueAuthorizationRequestCreate" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/IssueAuthorizationRequest" }
        "400": { $ref: "#/components/responses/BadRequest" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
        "409":
          description: A pending authorization request already exists for this org and collection
          content:
            application/json:
              schema: { $ref: "#/components/schemas/ErrorResponse" }
    get:
      operationId: listIssueAuthorizations
      tags: [Requests]
      summary: List authorization requests for this collection (creator review)
      description: Returns authorization requests for the collection, for the creator to review.
      x-permissions: ["collections:authorize:manage"]
      parameters:
        - $ref: "#/components/parameters/CollectionId"
        - $ref: "#/components/parameters/Page"
        - $ref: "#/components/parameters/PageSize"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PagedIssueAuthorizationRequests" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /issue-authorizations/{authRequestId}/approve:
    post:
      operationId: approveIssueAuthorization
      tags: [Requests]
      summary: Approve issue authorization request
      description: Grants an org the authorization to issue badges from the collection.
      x-permissions: ["collections:authorize:manage"]
      parameters:
        - $ref: "#/components/parameters/AuthRequestId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/IssueAuthorization" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /issue-authorizations/{authRequestId}/reject:
    post:
      operationId: rejectIssueAuthorization
      tags: [Requests]
      summary: Reject issue authorization request
      description: Denies an org's request to issue badges from the collection.
      x-permissions: ["collections:authorize:manage"]
      parameters:
        - $ref: "#/components/parameters/AuthRequestId"
      responses:
        "204": { description: No Content }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /public/assertions/{assertionId}:
    get:
      operationId: getPublicAssertion
      tags: [Public]
      summary: Public verification payload for an issued badge (Assertion)
      description: Returns the publicly verifiable assertion data for an issued badge. No authentication required.
      security: []
      parameters:
        - $ref: "#/components/parameters/AssertionId"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Assertion" }
        "404": { $ref: "#/components/responses/NotFound" }

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  responses:
    BadRequest:
      description: Validation error
      content:
        application/json:
          schema: { $ref: "#/components/schemas/ErrorResponse" }
    Unauthorized:
      description: Missing or invalid authentication token
      content:
        application/json:
          schema: { $ref: "#/components/schemas/ErrorResponse" }
    Forbidden:
      description: Insufficient permissions
      content:
        application/json:
          schema: { $ref: "#/components/schemas/ErrorResponse" }
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema: { $ref: "#/components/schemas/ErrorResponse" }

  parameters:
    Page:
      name: page
      in: query
      description: Page number (1-indexed).
      schema: { type: integer, minimum: 1, default: 1 }
    PageSize:
      name: pageSize
      in: query
      description: Number of items per page.
      schema: { type: integer, minimum: 1, maximum: 200, default: 25 }
    Query:
      name: q
      in: query
      schema: { type: string }
      description: Keyword search.
    OrgId:
      name: orgId
      in: path
      required: true
      description: Organization ID.
      schema: { type: string, example: "org_abc123" }
    CohortId:
      name: cohortId
      in: path
      required: true
      description: Cohort ID.
      schema: { type: string, example: "coh_abc123" }
    MemberId:
      name: memberId
      in: path
      required: true
      description: Org member ID.
      schema: { type: string, example: "mem_abc123" }
    UserId:
      name: userId
      in: path
      required: true
      description: User ID.
      schema: { type: string, example: "usr_abc123" }
    LearnerId:
      name: learnerId
      in: path
      required: true
      description: Learner ID.
      schema: { type: string, example: "lrn_abc123" }
    BadgeId:
      name: badgeId
      in: path
      required: true
      description: Badge ID.
      schema: { type: string, example: "bdg_abc123" }
    CollectionId:
      name: collectionId
      in: path
      required: true
      description: Collection ID.
      schema: { type: string, example: "col_abc123" }
    RequestId:
      name: requestId
      in: path
      required: true
      description: Membership request ID.
      schema: { type: string, example: "req_abc123" }
    AuthRequestId:
      name: authRequestId
      in: path
      required: true
      description: Issue authorization request ID.
      schema: { type: string, example: "iar_abc123" }
    AssertionId:
      name: assertionId
      in: path
      required: true
      description: Public assertion ID.
      schema: { type: string, example: "ast_abc123" }
    ProgramId:
      name: programId
      in: path
      required: true
      description: Program ID.
      schema: { type: string, example: "prg_abc123" }
    ProgramSlug:
      name: programSlug
      in: path
      required: true
      description: Program slug.
      schema: { type: string, example: "leadership-track" }
    CohortAssignmentId:
      name: cohortAssignmentId
      in: path
      required: true
      description: Cohort program assignment ID.
      schema: { type: string, example: "asn_coh_abc123" }
    LearnerAssignmentId:
      name: learnerAssignmentId
      in: path
      required: true
      description: Learner program assignment ID.
      schema: { type: string, example: "asn_lrn_abc123" }
    CheckpointCompletionId:
      name: completionId
      in: path
      required: true
      description: Checkpoint completion ID.
      schema: { type: string, example: "chk_cmp_abc123" }

  schemas:
    # ---------- Common ----------
    ISODateTime:
      type: string
      format: date-time
      description: ISO 8601 date-time string.
      example: "2025-06-15T10:30:00Z"

    PagedMeta:
      type: object
      description: Pagination metadata included in all list responses.
      properties:
        page: { type: integer, description: "Current page number.", example: 1 }
        pageSize: { type: integer, description: "Items per page.", example: 25 }
        total: { type: integer, description: "Total number of items.", example: 42 }
      required: [page, pageSize, total]

    ErrorResponse:
      type: object
      description: Standard error envelope returned for all non-2xx responses.
      properties:
        message:
          type: string
          description: Human-readable error message.
          example: "Validation failed"
        code:
          type: string
          description: Machine-readable error code for programmatic handling.
          example: "VALIDATION_ERROR"
      required: [message]

    # ---------- Auth ----------
    RegisterRequest:
      type: object
      description: Payload for user registration.
      properties:
        email:
          type: string
          format: email
          description: User's email address. Must be unique.
          example: "jane@example.com"
        password:
          type: string
          minLength: 8
          maxLength: 128
          description: Account password.
          example: "s3cureP@ss"
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: User's display name.
          example: "Jane Doe"
      required: [email, password]

    LoginRequest:
      type: object
      description: Payload for user login.
      properties:
        email:
          type: string
          format: email
          description: Registered email address.
          example: "jane@example.com"
        password:
          type: string
          description: Account password.
          example: "s3cureP@ss"
      required: [email, password]

    RefreshRequest:
      type: object
      description: Payload for token refresh.
      properties:
        refreshToken:
          type: string
          description: The refresh token issued during login or a previous refresh.
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      required: [refreshToken]

    AuthResponse:
      type: object
      description: Returned on successful authentication (login, register, or refresh).
      properties:
        accessToken:
          type: string
          description: Short-lived JWT access token for API authorization.
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        refreshToken:
          type: string
          description: Long-lived refresh token for obtaining new access tokens.
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        user: { $ref: "#/components/schemas/User" }
      required: [accessToken, user]

    # ---------- Users ----------
    User:
      type: object
      description: A platform user account.
      properties:
        id:
          type: string
          description: Unique user identifier.
          example: "usr_abc123"
        email:
          type: string
          format: email
          description: User's email address.
          example: "jane@example.com"
        name:
          type: string
          description: User's display name.
          example: "Jane Doe"
        profileImageUrl:
          type: string
          format: uri
          description: URL to the user's profile picture.
          example: "https://cdn.example.com/users/jane-avatar.jpg"
        coverImageUrl:
          type: string
          format: uri
          description: URL to the user's cover/banner image.
          example: "https://cdn.example.com/users/jane-cover.jpg"
        bio:
          type: string
          maxLength: 500
          description: Short biography or description.
          example: "Credentialing specialist passionate about open badges and lifelong learning."
        title:
          type: string
          maxLength: 120
          description: Professional title or role.
          example: "Director of Credentialing"
        location:
          type: string
          maxLength: 120
          description: City, region, or general location.
          example: "Austin, TX"
        socialLinks:
          $ref: "#/components/schemas/SocialLinks"
        createdAt: { $ref: "#/components/schemas/ISODateTime" }
      required: [id, email]

    SocialLinks:
      type: object
      description: Optional social/professional links for a user profile.
      properties:
        linkedin:
          type: string
          format: uri
          description: LinkedIn profile URL.
          example: "https://linkedin.com/in/janedoe"
        website:
          type: string
          format: uri
          description: Personal or professional website.
          example: "https://janedoe.com"
        x:
          type: string
          format: uri
          description: X (Twitter) profile URL.
          example: "https://x.com/janedoe"

    UserSettings:
      type: object
      description: Per-user preference settings.
      properties:
        locale:
          type: string
          description: Preferred locale for the UI.
          default: "en-US"
          example: "en-US"
        marketingEmails:
          type: boolean
          description: Whether the user has opted in to marketing emails.
          default: false
          example: false

    UserSettingsUpdateRequest:
      type: object
      description: Partial update for user settings.
      properties:
        locale: { type: string, example: "fr-FR" }
        marketingEmails: { type: boolean }

    PagedUsers:
      type: object
      properties:
        meta: { $ref: "#/components/schemas/PagedMeta" }
        data:
          type: array
          items: { $ref: "#/components/schemas/User" }
      required: [meta, data]

    # ---------- Orgs ----------
    Org:
      type: object
      description: An organization that manages staff, learners, and badge issuance.
      properties:
        id:
          type: string
          description: Unique organization identifier.
          example: "org_abc123"
        name:
          type: string
          description: Organization display name.
          example: "Acme Training Co."
        slug:
          type: string
          pattern: "^[a-z0-9]+(?:-[a-z0-9]+)*$"
          description: URL-friendly unique identifier for the organization.
          example: "acme-training"
        about:
          type: string
          description: Short description or bio for the organization.
          example: "We provide industry-leading professional development."
        imageUrl:
          type: string
          format: uri
          description: URL to the organization's logo or avatar image.
          example: "https://cdn.example.com/orgs/acme-logo.png"
        coverImageUrl:
          type: string
          format: uri
          description: URL to the organization's cover/banner image.
          example: "https://cdn.example.com/orgs/acme-cover.jpg"
        contactEmail:
          type: string
          format: email
          description: Public contact email for the organization.
          example: "contact@acme.com"
        phone:
          type: string
          maxLength: 30
          description: Public contact phone number.
          example: "+1 (512) 555-0199"
        website:
          type: string
          format: uri
          description: Organization website URL.
          example: "https://acmetraining.com"
        location:
          type: string
          maxLength: 200
          description: City, region, or general address.
          example: "Austin, TX"
        socialLinks:
          $ref: "#/components/schemas/SocialLinks"
        createdAt: { $ref: "#/components/schemas/ISODateTime" }
        updatedAt: { $ref: "#/components/schemas/ISODateTime" }
      required: [id, name, slug]

    OrgCreateRequest:
      type: object
      description: Payload for creating an organization.
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Organization name.
          example: "Acme Training Co."
        slug:
          type: string
          pattern: "^[a-z0-9]+(?:-[a-z0-9]+)*$"
          description: URL-friendly identifier. Auto-generated from name if omitted.
          example: "acme-training"
        about:
          type: string
          maxLength: 2000
          description: Short description of the organization.
          example: "We provide industry-leading professional development."
        coverImageUrl:
          type: string
          format: uri
          description: Cover/banner image URL.
        contactEmail:
          type: string
          format: email
          description: Public contact email.
          example: "contact@acme.com"
        phone:
          type: string
          maxLength: 30
          description: Public phone number.
        website:
          type: string
          format: uri
          description: Organization website.
        location:
          type: string
          maxLength: 200
          description: City or region.
        socialLinks:
          $ref: "#/components/schemas/SocialLinks"
      required: [name]

    OrgUpdateRequest:
      type: object
      description: Partial update for an organization's profile.
      properties:
        name: { type: string, minLength: 1, maxLength: 255 }
        slug: { type: string, pattern: "^[a-z0-9]+(?:-[a-z0-9]+)*$" }
        about: { type: string, maxLength: 2000 }
        imageUrl: { type: string, format: uri }
        coverImageUrl: { type: string, format: uri }
        contactEmail: { type: string, format: email }
        phone: { type: string, maxLength: 30 }
        website: { type: string, format: uri }
        location: { type: string, maxLength: 200 }
        socialLinks: { $ref: "#/components/schemas/SocialLinks" }

    OrgSettings:
      type: object
      description: Organization-level settings controlling membership policies.
      properties:
        allowSelfJoin:
          type: boolean
          default: false
          description: Whether users can join this org without an invite.
          example: false
        requireAdminApprovalForJoin:
          type: boolean
          default: true
          description: Whether join requests require admin approval.
          example: true
        defaultMemberRole:
          type: string
          default: "issuer"
          description: Default role assigned to new members.
          example: "issuer"
      required: [allowSelfJoin, requireAdminApprovalForJoin]

    OrgSettingsUpdateRequest:
      type: object
      description: Partial update for organization settings.
      properties:
        allowSelfJoin: { type: boolean }
        requireAdminApprovalForJoin: { type: boolean }
        defaultMemberRole: { type: string }

    OrgStats:
      type: object
      description: Aggregated statistics for an organization.
      properties:
        totalMembers:
          type: integer
          description: Total active staff members.
          example: 12
        totalLearners:
          type: integer
          description: Total learners affiliated with the org.
          example: 347
        totalBadges:
          type: integer
          description: Total badge definitions created by the org.
          example: 24
        totalIssuances:
          type: integer
          description: Total badges issued to learners.
          example: 1583
        activeLearners:
          type: integer
          description: Learners with active status.
          example: 310
        badgesIssuedThisMonth:
          type: integer
          description: Badges issued in the current calendar month.
          example: 47
        badgesIssuedThisYear:
          type: integer
          description: Badges issued in the current calendar year.
          example: 892
      required:
        - totalMembers
        - totalLearners
        - totalBadges
        - totalIssuances
        - activeLearners
        - badgesIssuedThisMonth
        - badgesIssuedThisYear

    PagedOrgs:
      type: object
      properties:
        meta: { $ref: "#/components/schemas/PagedMeta" }
        data:
          type: array
          items: { $ref: "#/components/schemas/Org" }
      required: [meta, data]

    # ---------- Org Members ----------
    OrgMember:
      type: object
      description: A staff membership record linking a user to an organization with a specific role.
      properties:
        id:
          type: string
          description: Unique membership record identifier.
          example: "mem_abc123"
        orgId:
          type: string
          description: The organization this membership belongs to.
          example: "org_abc123"
        userId:
          type: string
          description: The user who holds this membership.
          example: "usr_abc123"
        role:
          type: string
          enum: [owner, admin, issuer, viewer]
          description: The member's role within the org.
          example: "admin"
        status:
          type: string
          enum: [active, invited, suspended]
          description: Current membership status.
          example: "active"
        createdAt: { $ref: "#/components/schemas/ISODateTime" }
      required: [id, orgId, userId, role, status]

    OrgMemberUpdateRequest:
      type: object
      description: Partial update for a membership record.
      properties:
        role:
          type: string
          enum: [owner, admin, issuer, viewer]
        status:
          type: string
          enum: [active, suspended]

    PagedOrgMembers:
      type: object
      properties:
        meta: { $ref: "#/components/schemas/PagedMeta" }
        data:
          type: array
          items: { $ref: "#/components/schemas/OrgMember" }
      required: [meta, data]

    OrgMemberDetail:
      allOf:
        - $ref: "#/components/schemas/OrgMember"
        - type: object
          description: Extended org-member record with nested user profile.
          properties:
            user: { $ref: "#/components/schemas/User" }

    PagedOrgMemberDetails:
      type: object
      properties:
        meta: { $ref: "#/components/schemas/PagedMeta" }
        data:
          type: array
          items: { $ref: "#/components/schemas/OrgMemberDetail" }
      required: [meta, data]

    UserOrgMembership:
      type: object
      description: An organization together with the user's membership record in it.
      properties:
        org: { $ref: "#/components/schemas/Org" }
        membership: { $ref: "#/components/schemas/OrgMember" }
      required: [org, membership]

    # ---------- Membership Requests ----------
    MembershipRequestCreate:
      type: object
      description: Payload for creating a membership request (self-join or admin invite).
      properties:
        userId:
          type: string
          description: Target user ID. If omitted, the request is for the authenticated user.
          example: "usr_abc123"
        message:
          type: string
          maxLength: 1000
          description: Optional message from the requester.
          example: "I'd like to join your organization to help issue badges."
      additionalProperties: false

    MembershipRequest:
      type: object
      description: A request for a user to become a member of an organization.
      properties:
        id:
          type: string
          description: Unique request identifier.
          example: "req_abc123"
        orgId:
          type: string
          description: Target organization.
          example: "org_abc123"
        userId:
          type: string
          description: Requesting user.
          example: "usr_abc123"
        status:
          type: string
          enum: [pending, approved, rejected, canceled]
          description: Current request status.
          example: "pending"
        message:
          type: string
          description: Optional message from the requester.
          example: "I'd like to join your organization to help issue badges."
        createdAt: { $ref: "#/components/schemas/ISODateTime" }
      required: [id, orgId, userId, status]

    PagedMembershipRequests:
      type: object
      properties:
        meta: { $ref: "#/components/schemas/PagedMeta" }
        data:
          type: array
          items: { $ref: "#/components/schemas/MembershipRequest" }
      required: [meta, data]

    # ---------- Learners ----------
    Learner:
      type: object
      description: A learner's global profile, independent of any organization.
      properties:
        id:
          type: string
          description: Unique learner identifier.
          example: "lrn_abc123"
        name:
          type: string
          description: Learner's display name.
          example: "Alex Rivera"
        email:
          type: string
          format: email
          description: Learner's email address (may be null for externally provisioned learners).
          example: "alex@example.com"
        createdAt: { $ref: "#/components/schemas/ISODateTime" }
      required: [id]

    OrgLearner:
      type: object
      description: A learner's affiliation with an organization, including org-specific metadata.
      properties:
        id:
          type: string
          description: Unique org-learner record identifier.
          example: "olr_abc123"
        orgId:
          type: string
          description: The organization this learner is affiliated with.
          example: "org_abc123"
        learnerId:
          type: string
          description: The learner's global ID.
          example: "lrn_abc123"
        externalRef:
          type: string
          description: External reference such as a roster ID or SIS ID.
          example: "SIS-2025-0042"
        status:
          type: string
          enum: [active, archived]
          description: Whether this learner is active or archived in the org.
          example: "active"
        createdAt: { $ref: "#/components/schemas/ISODateTime" }
      required: [id, orgId, learnerId, status]

    OrgLearnerCreateRequest:
      type: object
      description: Payload for provisioning a learner in an organization.
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Learner's display name.
          example: "Alex Rivera"
        email:
          type: string
          format: email
          description: Learner's email address.
          example: "alex@example.com"
        externalRef:
          type: string
          maxLength: 255
          description: External roster or SIS identifier.
          example: "SIS-2025-0042"
      required: [name]

    OrgLearnerDetail:
      allOf:
        - $ref: "#/components/schemas/OrgLearner"
        - type: object
          description: Extended org-learner record with nested learner profile, badge progress, and issuances.
          properties:
            learner: { $ref: "#/components/schemas/Learner" }
            badgeProgress:
              type: array
              description: Badge progress records for this learner within this org.
              items: { $ref: "#/components/schemas/BadgeProgress" }
            issuances:
              type: array
              description: Badge issuances for this learner within this org.
              items: { $ref: "#/components/schemas/Issuance" }

    PagedLearners:
      type: object
      properties:
        meta: { $ref: "#/components/schemas/PagedMeta" }
        data:
          type: array
          items: { $ref: "#/components/schemas/Learner" }
      required: [meta, data]

    PagedOrgLearners:
      type: object
      properties:
        meta: { $ref: "#/components/schemas/PagedMeta" }
        data:
          type: array
          items: { $ref: "#/components/schemas/OrgLearnerDetail" }
      required: [meta, data]

    BulkLearnerImportRequest:
      type: object
      description: Payload for bulk-importing learners into an organization.
      properties:
        learners:
          type: array
          description: List of learner records to import.
          items: { $ref: "#/components/schemas/OrgLearnerCreateRequest" }
      required: [learners]

    ImportJob:
      type: object
      description: Status of an asynchronous bulk import job.
      properties:
        id:
          type: string
          description: Unique job identifier.
          example: "job_abc123"
        status:
          type: string
          enum: [queued, running, complete, failed]
          description: Current job status.
          example: "queued"
        totalCount:
          type: integer
          description: Total number of records in the import.
          example: 150
        successCount:
          type: integer
          description: Number of records successfully imported so far.
          example: 0
        errorCount:
          type: integer
          description: Number of records that failed to import.
          example: 0
        createdAt: { $ref: "#/components/schemas/ISODateTime" }
        errors:
          type: array
          description: Error messages for individual failed records.
          items: { type: string }
      required: [id, status]

    # ---------- Badges ----------
    Badge:
      type: object
      description: A badge definition including its criteria. Aligned with Open Badges concepts.
      properties:
        id:
          type: string
          description: Unique badge identifier.
          example: "bdg_abc123"
        name:
          type: string
          description: Badge display name.
          example: "Project Management Fundamentals"
        description:
          type: string
          description: Detailed description of what this badge represents.
          example: "Awarded for demonstrating core project management competencies."
        imageUrl:
          type: string
          format: uri
          description: URL to the badge image.
          example: "https://cdn.example.com/badges/pm-fundamentals.png"
        criteria:
          type: array
          description: List of criteria that must be met to earn this badge.
          items: { $ref: "#/components/schemas/BadgeCriteriaItem" }
        createdByOrgId:
          type: string
          description: The org that created this badge.
          example: "org_abc123"
        createdAt: { $ref: "#/components/schemas/ISODateTime" }
        updatedAt: { $ref: "#/components/schemas/ISODateTime" }
      required: [id, name]

    BadgeCriteriaItem:
      type: object
      description: A single criterion within a badge definition.
      properties:
        id:
          type: string
          description: Unique criterion identifier.
          example: "crt_abc123"
        label:
          type: string
          description: Human-readable description of the criterion.
          example: "Complete the risk assessment module"
        isRequired:
          type: boolean
          default: true
          description: Whether this criterion is required to earn the badge.
          example: true
      required: [id, label]

    BadgeCreateRequest:
      type: object
      description: Payload for creating a badge.
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Badge name.
          example: "Project Management Fundamentals"
        description:
          type: string
          maxLength: 2000
          description: Badge description.
          example: "Awarded for demonstrating core project management competencies."
        imageUrl:
          type: string
          format: uri
          description: URL to the badge image.
        criteria:
          type: array
          description: Initial criteria for the badge.
          items: { $ref: "#/components/schemas/BadgeCriteriaItem" }
        createdByOrgId:
          type: string
          description: The org creating this badge.
          example: "org_abc123"
      required: [name, createdByOrgId]

    BadgeUpdateRequest:
      type: object
      description: Partial update for a badge definition.
      properties:
        name: { type: string, minLength: 1, maxLength: 255 }
        description: { type: string, maxLength: 2000 }
        imageUrl: { type: string, format: uri }
        criteria:
          type: array
          items: { $ref: "#/components/schemas/BadgeCriteriaItem" }

    PagedBadges:
      type: object
      properties:
        meta: { $ref: "#/components/schemas/PagedMeta" }
        data:
          type: array
          items: { $ref: "#/components/schemas/Badge" }
      required: [meta, data]

    # ---------- Progress ----------
    BadgeProgress:
      type: object
      description: Tracks a learner's progress toward earning a badge within a specific org.
      properties:
        orgId:
          type: string
          description: The org in which this progress is tracked.
          example: "org_abc123"
        learnerId:
          type: string
          description: The learner this progress belongs to.
          example: "lrn_abc123"
        badgeId:
          type: string
          description: The badge being worked toward.
          example: "bdg_abc123"
        status:
          type: string
          enum: [not_started, in_progress, complete]
          description: Current progress status.
          example: "in_progress"
        completedCriteriaIds:
          type: array
          description: IDs of criteria the learner has completed.
          items: { type: string }
          example: ["crt_001", "crt_002"]
        updatedAt: { $ref: "#/components/schemas/ISODateTime" }
      required: [orgId, learnerId, badgeId, status]

    BadgeProgressUpdateRequest:
      type: object
      description: Partial update for a learner's badge progress.
      properties:
        status:
          type: string
          enum: [in_progress, complete]
        completedCriteriaIds:
          type: array
          items: { type: string }

    # ---------- Issuances / Assertions ----------
    IssuanceCreateRequest:
      type: object
      description: Payload for issuing a badge to a learner.
      properties:
        learnerId:
          type: string
          description: The learner receiving the badge.
          example: "lrn_abc123"
        badgeId:
          type: string
          description: The badge being issued.
          example: "bdg_abc123"
        evidenceUrl:
          type: string
          format: uri
          description: Optional URL to supporting evidence.
          example: "https://example.com/evidence/portfolio-2025"
      required: [learnerId, badgeId]

    Issuance:
      type: object
      description: Record of a badge being issued to a learner by an org.
      properties:
        id:
          type: string
          description: Unique issuance identifier.
          example: "iss_abc123"
        orgId:
          type: string
          description: The org that issued the badge.
          example: "org_abc123"
        learnerId:
          type: string
          description: The learner who received the badge.
          example: "lrn_abc123"
        badgeId:
          type: string
          description: The badge that was issued.
          example: "bdg_abc123"
        assertionId:
          type: string
          description: The public assertion ID for verification.
          example: "ast_abc123"
        status:
          type: string
          enum: [issued, revoked]
          description: Current issuance status.
          example: "issued"
        issuedAt: { $ref: "#/components/schemas/ISODateTime" }
        revokedAt:
          description: When the issuance was revoked, if applicable.
          oneOf:
            - { $ref: "#/components/schemas/ISODateTime" }
            - type: "null"
      required: [id, orgId, learnerId, badgeId, assertionId, status, issuedAt]

    PagedIssuances:
      type: object
      properties:
        meta: { $ref: "#/components/schemas/PagedMeta" }
        data:
          type: array
          items: { $ref: "#/components/schemas/Issuance" }
      required: [meta, data]

    Assertion:
      type: object
      description: Public verification payload for an issued badge, aligned with Open Badges concepts.
      properties:
        id:
          type: string
          description: Unique assertion identifier.
          example: "ast_abc123"
        issuerOrgId:
          type: string
          description: The org that issued the badge.
          example: "org_abc123"
        recipientLearnerId:
          type: string
          description: The learner who earned the badge.
          example: "lrn_abc123"
        badgeId:
          type: string
          description: The badge that was earned.
          example: "bdg_abc123"
        issuedAt: { $ref: "#/components/schemas/ISODateTime" }
        evidenceUrl:
          type: string
          format: uri
          description: Optional URL to supporting evidence.
          example: "https://example.com/evidence/portfolio-2025"
      required: [id, issuerOrgId, recipientLearnerId, badgeId, issuedAt]

    # ---------- Learner Badge View ----------
    LearnerBadgeJourney:
      type: object
      description: A learner's full journey for a specific badge across all orgs.
      properties:
        learnerId:
          type: string
          description: The learner.
          example: "lrn_abc123"
        badge: { $ref: "#/components/schemas/Badge" }
        progressByOrg:
          type: array
          description: Progress records from each org tracking this badge.
          items: { $ref: "#/components/schemas/BadgeProgress" }
        assertions:
          type: array
          description: Assertions earned for this badge.
          items: { $ref: "#/components/schemas/Assertion" }
      required: [learnerId, badge]

    PagedLearnerBadges:
      type: object
      properties:
        meta: { $ref: "#/components/schemas/PagedMeta" }
        data:
          type: array
          items: { $ref: "#/components/schemas/LearnerBadgeJourney" }
      required: [meta, data]

    # ---------- Collections ----------
    Collection:
      type: object
      description: A curated group of badges, optionally published to the public registry.
      properties:
        id:
          type: string
          description: Unique collection identifier.
          example: "col_abc123"
        name:
          type: string
          description: Collection display name.
          example: "Leadership Development Program"
        description:
          type: string
          description: Description of the collection's purpose.
          example: "A series of badges covering leadership competencies."
        createdByOrgId:
          type: string
          description: The org that created this collection.
          example: "org_abc123"
        imageUrl:
          type: string
          format: uri
          description: Cover image URL for the collection.
          example: "https://cdn.example.com/collections/leadership-cover.png"
        badgeCount:
          type: integer
          description: Total number of badges in the collection.
          example: 8
        published:
          type: boolean
          default: false
          description: Whether this collection is visible in the public registry.
          example: false
        createdAt: { $ref: "#/components/schemas/ISODateTime" }
        updatedAt: { $ref: "#/components/schemas/ISODateTime" }
      required: [id, name, createdByOrgId]

    CollectionDetail:
      allOf:
        - $ref: "#/components/schemas/Collection"
        - type: object
          description: Collection with embedded badge summaries and usage stats.
          properties:
            badgeSummaries:
              type: array
              description: Summary of each badge in the collection.
              items:
                type: object
                properties:
                  id:
                    type: string
                    example: "bdg_abc123"
                  name:
                    type: string
                    example: "Project Management Fundamentals"
                  description:
                    type: string
                    example: "Awarded for demonstrating core PM competencies."
                  imageUrl:
                    type: string
                    format: uri
                    example: "https://cdn.example.com/badges/pm-fundamentals.png"
                  issuanceCount:
                    type: integer
                    description: Total number of times this badge has been issued.
                    example: 142
                required: [id, name]
            stats:
              $ref: "#/components/schemas/CollectionStats"

    CollectionStats:
      type: object
      description: Aggregated usage statistics for a collection.
      properties:
        totalIssuances:
          type: integer
          description: Total badges issued across all badges in this collection.
          example: 1583
        uniqueLearners:
          type: integer
          description: Distinct learners who earned at least one badge in this collection.
          example: 420
        badgeCount:
          type: integer
          description: Number of badges in this collection.
          example: 12
        averageCompletionRate:
          type: number
          format: float
          description: Average percentage of learners who complete all badges (0-100).
          example: 68.5
      required: [totalIssuances, uniqueLearners, badgeCount]

    CollectionCreateRequest:
      type: object
      description: Payload for creating a collection.
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Collection name.
          example: "Leadership Development Program"
        description:
          type: string
          maxLength: 2000
          description: Collection description.
          example: "A series of badges covering leadership competencies."
        imageUrl:
          type: string
          format: uri
          description: Cover image URL for the collection.
        createdByOrgId:
          type: string
          description: The org creating this collection.
          example: "org_abc123"
        badgeIds:
          type: array
          description: Initial badge IDs to include in the collection.
          items: { type: string }
      required: [name, createdByOrgId]

    CollectionUpdateRequest:
      type: object
      description: Partial update for a collection, including adding or removing badges.
      properties:
        name: { type: string, minLength: 1, maxLength: 255 }
        description: { type: string, maxLength: 2000 }
        imageUrl: { type: string, format: uri }
        addBadgeIds:
          type: array
          description: Badge IDs to add to the collection.
          items: { type: string }
        removeBadgeIds:
          type: array
          description: Badge IDs to remove from the collection.
          items: { type: string }

    PagedCollections:
      type: object
      properties:
        meta: { $ref: "#/components/schemas/PagedMeta" }
        data:
          type: array
          items: { $ref: "#/components/schemas/Collection" }
      required: [meta, data]

    # ---------- Issue Authorization Requests ----------
    IssueAuthorizationRequestCreate:
      type: object
      description: Payload for requesting authorization to issue badges from a collection.
      properties:
        requestingOrgId:
          type: string
          description: The org requesting issuance authorization.
          example: "org_def456"
        message:
          type: string
          maxLength: 1000
          description: Optional message explaining the request.
          example: "We'd like to use your Leadership badges in our program."
      required: [requestingOrgId]

    IssueAuthorizationRequest:
      type: object
      description: A request from an org to be authorized to issue badges from a collection.
      properties:
        id:
          type: string
          description: Unique request identifier.
          example: "iar_abc123"
        collectionId:
          type: string
          description: The collection being requested.
          example: "col_abc123"
        requestingOrgId:
          type: string
          description: The org requesting authorization.
          example: "org_def456"
        status:
          type: string
          enum: [pending, approved, rejected]
          description: Current request status.
          example: "pending"
        message:
          type: string
          description: Optional message from the requester.
          example: "We'd like to use your Leadership badges in our program."
        createdAt: { $ref: "#/components/schemas/ISODateTime" }
      required: [id, collectionId, requestingOrgId, status]

    IssueAuthorization:
      type: object
      description: A granted authorization for an org to issue badges from a collection.
      properties:
        id:
          type: string
          description: Unique authorization identifier.
          example: "iau_abc123"
        collectionId:
          type: string
          description: The authorized collection.
          example: "col_abc123"
        orgId:
          type: string
          description: The authorized org.
          example: "org_def456"
        grantedAt: { $ref: "#/components/schemas/ISODateTime" }
      required: [id, collectionId, orgId]

    PagedIssueAuthorizationRequests:
      type: object
      properties:
        meta: { $ref: "#/components/schemas/PagedMeta" }
        data:
          type: array
          items: { $ref: "#/components/schemas/IssueAuthorizationRequest" }
      required: [meta, data]

    # ---------- Cohorts ----------
    Cohort:
      type: object
      description: A named group of learners within an organization.
      properties:
        id:
          type: string
          description: Unique cohort identifier.
          example: "coh_abc123"
        orgId:
          type: string
          description: The org this cohort belongs to.
          example: "org_abc123"
        name:
          type: string
          description: Cohort display name.
          example: "Fall 2025 Cohort"
        slug:
          type: string
          description: URL-safe identifier for routing.
          example: "fall-2025-cohort"
        description:
          type: string
          description: Optional description of the cohort.
          example: "Learners enrolled in the Fall 2025 training program."
        status:
          type: string
          enum: [active, draft, archived]
          description: Current cohort status.
          example: "active"
        coverImageUrl:
          type: string
          format: uri
          description: Optional cover image URL for display.
          example: "https://images.unsplash.com/photo-1234?w=400&h=300"
        assignedStaffIds:
          type: array
          description: Member IDs of staff assigned to this cohort.
          items: { type: string }
          example: ["mem_abc123", "mem_def456"]
        learnerCount:
          type: integer
          description: Number of learners in this cohort.
          example: 24
        createdAt: { $ref: "#/components/schemas/ISODateTime" }
        updatedAt: { $ref: "#/components/schemas/ISODateTime" }
      required: [id, orgId, name, slug, status]

    CohortDetail:
      allOf:
        - $ref: "#/components/schemas/Cohort"
        - type: object
          description: Cohort with embedded learner list.
          properties:
            learners:
              type: array
              description: Learners in this cohort.
              items: { $ref: "#/components/schemas/Learner" }

    CohortCreateRequest:
      type: object
      description: Payload for creating a cohort.
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Cohort name.
          example: "Fall 2025 Cohort"
        slug:
          type: string
          minLength: 1
          maxLength: 255
          description: URL-safe identifier.
          example: "fall-2025-cohort"
        description:
          type: string
          maxLength: 2000
          description: Optional description.
          example: "Learners enrolled in the Fall 2025 training program."
        status:
          type: string
          enum: [active, draft, archived]
          description: Cohort status (defaults to draft).
          example: "draft"
        coverImageUrl:
          type: string
          format: uri
          description: Optional cover image URL.
        assignedStaffIds:
          type: array
          description: Member IDs of staff to assign.
          items: { type: string }
      required: [name, slug]

    CohortUpdateRequest:
      type: object
      description: Partial update for a cohort.
      properties:
        name: { type: string, minLength: 1, maxLength: 255 }
        slug: { type: string, minLength: 1, maxLength: 255 }
        description: { type: string, maxLength: 2000 }
        status: { type: string, enum: [active, draft, archived] }
        coverImageUrl: { type: string, format: uri }
        assignedStaffIds: { type: array, items: { type: string } }

    CohortLearnersAddRequest:
      type: object
      description: Payload for adding learners to a cohort.
      properties:
        learnerIds:
          type: array
          description: List of learner IDs to add.
          items: { type: string }
          example: ["lrn_abc123", "lrn_def456"]
      required: [learnerIds]

    PagedCohorts:
      type: object
      properties:
        meta: { $ref: "#/components/schemas/PagedMeta" }
        data:
          type: array
          items: { $ref: "#/components/schemas/Cohort" }
      required: [meta, data]

    # ---------- Programs ----------
    Program:
      type: object
      description: A reusable credential program template containing phases, badges, and checkpoints.
      properties:
        id:
          type: string
          description: Unique program identifier.
          example: "prg_abc123"
        orgId:
          type: string
          description: The organization that created this program.
          example: "org_abc123"
        name:
          type: string
          description: Program display name.
          example: "Leadership Development Track"
        slug:
          type: string
          pattern: "^[a-z0-9]+(?:-[a-z0-9]+)*$"
          description: URL-friendly unique identifier for the program.
          example: "leadership-development-track"
        description:
          type: string
          description: Detailed program description and objectives.
          example: "Comprehensive leadership training program spanning core competencies."
        imageUrl:
          type: string
          format: uri
          description: Cover image URL for the program.
          example: "https://cdn.example.com/programs/leadership-cover.png"
        status:
          type: string
          enum: [draft, active, archived]
          description: Current program status.
          example: "active"
        phaseCount:
          type: integer
          description: Total number of phases in the program.
          example: 4
        totalBadgeCount:
          type: integer
          description: Total number of badges across all phases.
          example: 12
        totalCheckpointCount:
          type: integer
          description: Total number of checkpoints across all phases.
          example: 8
        createdAt: { $ref: "#/components/schemas/ISODateTime" }
        updatedAt: { $ref: "#/components/schemas/ISODateTime" }
      required: [id, orgId, name, slug, status]

    ProgramDetail:
      allOf:
        - $ref: "#/components/schemas/Program"
        - type: object
          description: Program with full phase details including badges and checkpoints.
          properties:
            phases:
              type: array
              description: Ordered list of phases in this program.
              items: { $ref: "#/components/schemas/Phase" }

    Phase:
      type: object
      description: A phase within a program containing badges and checkpoints.
      properties:
        id:
          type: string
          description: Unique phase identifier.
          example: "phs_abc123"
        name:
          type: string
          description: Phase display name.
          example: "Foundation Skills"
        description:
          type: string
          description: Phase description and learning objectives.
          example: "Core foundational competencies required for leadership roles."
        order:
          type: integer
          description: Display order within the program (0-indexed).
          example: 0
        badges:
          type: array
          description: Badges included in this phase, with collection context for linking.
          items: { $ref: "#/components/schemas/PhaseBadge" }
        checkpoints:
          type: array
          description: Checkpoints that must be signed off in this phase.
          items: { $ref: "#/components/schemas/Checkpoint" }
      required: [id, name, order, badges, checkpoints]

    PhaseBadge:
      type: object
      description: A badge within a program phase, including collection context for constructing badge detail links.
      properties:
        id:
          type: string
          description: Badge identifier.
          example: "bdg_abc123"
        name:
          type: string
          description: Badge display name.
          example: "OSHA 10-Hour General Industry"
        collectionId:
          type: string
          description: Collection this badge belongs to (used to construct badge detail URLs).
          example: "col_abc123"
        imageUrl:
          type: string
          format: uri
          description: Badge image URL.
          example: "https://cdn.example.com/badges/osha.png"
      required: [id, name, collectionId]

    Checkpoint:
      type: object
      description: A program-specific milestone that requires staff sign-off.
      properties:
        id:
          type: string
          description: Unique checkpoint identifier.
          example: "chk_abc123"
        label:
          type: string
          description: Checkpoint description.
          example: "Complete project proposal review with mentor"
        isRequired:
          type: boolean
          default: true
          description: Whether this checkpoint is required for phase completion.
          example: true
      required: [id, label]

    ProgramCreateRequest:
      type: object
      description: Payload for creating a program.
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          description: Program name.
          example: "Leadership Development Track"
        description:
          type: string
          maxLength: 2000
          description: Program description.
        imageUrl:
          type: string
          format: uri
          description: Cover image URL.
        status:
          type: string
          enum: [draft, active, archived]
          default: draft
          description: Initial program status.
        phases:
          type: array
          description: Initial phases for the program.
          items: { $ref: "#/components/schemas/PhaseCreateRequest" }
      required: [name]

    PhaseCreateRequest:
      type: object
      description: Phase definition for program creation/update.
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 255
          example: "Foundation Skills"
        description:
          type: string
          maxLength: 1000
        order:
          type: integer
          minimum: 0
          example: 0
        badgeIds:
          type: array
          items:
            type: string
            example: "bdg_abc123"
        checkpoints:
          type: array
          items: { $ref: "#/components/schemas/CheckpointCreateRequest" }
      required: [name, order, badgeIds, checkpoints]

    CheckpointCreateRequest:
      type: object
      properties:
        label:
          type: string
          minLength: 1
          maxLength: 500
          example: "Complete project proposal review"
        isRequired:
          type: boolean
          default: true
      required: [label]

    ProgramUpdateRequest:
      type: object
      description: Payload for updating a program.
      properties:
        name: { type: string, minLength: 1, maxLength: 255 }
        description: { type: string, maxLength: 2000 }
        imageUrl: { type: string, format: uri }
        status:
          type: string
          enum: [draft, active, archived]
        phases:
          type: array
          items: { $ref: "#/components/schemas/PhaseCreateRequest" }

    PagedPrograms:
      type: object
      properties:
        meta: { $ref: "#/components/schemas/PagedMeta" }
        data:
          type: array
          items: { $ref: "#/components/schemas/Program" }
      required: [meta, data]

    # ---------- Program Assignments ----------
    CohortProgramAssignment:
      type: object
      description: A program assigned to a cohort, creating templates for learner assignments.
      properties:
        id:
          type: string
          description: Unique assignment identifier.
          example: "asn_coh_abc123"
        cohortId:
          type: string
          description: The cohort receiving the program.
          example: "coh_abc123"
        programId:
          type: string
          description: The program being assigned.
          example: "prg_abc123"
        assignedBy:
          type: string
          description: User ID who created the assignment.
          example: "usr_abc123"
        assignedAt: { $ref: "#/components/schemas/ISODateTime" }
        phaseDueDates:
          type: array
          description: Optional due dates for each phase (by phase ID).
          items: { $ref: "#/components/schemas/PhaseDueDate" }
      required: [id, cohortId, programId, assignedBy, assignedAt]

    CohortProgramAssignmentDetail:
      allOf:
        - $ref: "#/components/schemas/CohortProgramAssignment"
        - type: object
          description: Cohort assignment with program details and aggregate progress.
          properties:
            program: { $ref: "#/components/schemas/ProgramDetail" }
            cohort:
              type: object
              description: Basic cohort info.
              properties:
                id: { type: string, example: "coh_abc123" }
                name: { type: string, example: "Fall 2025 Cohort" }
                slug: { type: string, example: "fall-2025-cohort" }
              required: [id, name, slug]
            learnerAssignmentCount:
              type: integer
              description: Number of learners with this program assignment.
              example: 24

    LearnerProgramAssignment:
      type: object
      description: A program assigned to a learner, either directly or via cohort.
      properties:
        id:
          type: string
          description: Unique assignment identifier.
          example: "asn_lrn_abc123"
        learnerId:
          type: string
          description: The learner receiving the program.
          example: "lrn_abc123"
        programId:
          type: string
          description: The program being assigned.
          example: "prg_abc123"
        cohortAssignmentId:
          type: string
          description: If assigned via cohort, the cohort assignment ID.
          example: "asn_coh_abc123"
        assignedBy:
          type: string
          description: User ID who created the assignment.
          example: "usr_abc123"
        assignedAt: { $ref: "#/components/schemas/ISODateTime" }
        phaseDueDates:
          type: array
          description: Due dates for each phase (inherited or custom).
          items: { $ref: "#/components/schemas/PhaseDueDate" }
        completedAt:
          type: string
          format: date-time
          description: When the learner completed all requirements.
      required: [id, learnerId, programId, assignedBy, assignedAt]

    LearnerProgramAssignmentDetail:
      allOf:
        - $ref: "#/components/schemas/LearnerProgramAssignment"
        - type: object
          description: Learner assignment with full progress tracking.
          properties:
            program: { $ref: "#/components/schemas/ProgramDetail" }
            learner:
              type: object
              description: Basic learner info.
              properties:
                id: { type: string, example: "lrn_abc123" }
                name: { type: string, example: "Alex Rivera" }
                email: { type: string, example: "alex@example.com" }
              required: [id, name]
            progress: { $ref: "#/components/schemas/ProgramProgress" }

    ProgramProgress:
      type: object
      description: Learner's progress through a program.
      properties:
        badgesEarned:
          type: integer
          description: Number of badges earned.
          example: 5
        badgesTotal:
          type: integer
          description: Total badges in program.
          example: 12
        checkpointsSigned:
          type: integer
          description: Number of checkpoints signed.
          example: 3
        checkpointsTotal:
          type: integer
          description: Total checkpoints in program.
          example: 8
        phaseProgress:
          type: array
          description: Per-phase completion status.
          items: { $ref: "#/components/schemas/PhaseProgress" }
        checkpointCompletions:
          type: array
          description: All checkpoint completions for this assignment.
          items: { $ref: "#/components/schemas/CheckpointCompletion" }
      required: [badgesEarned, badgesTotal, checkpointsSigned, checkpointsTotal]

    PhaseProgress:
      type: object
      description: Progress for a single phase.
      properties:
        phaseId: { type: string, example: "phs_abc123" }
        badgesEarned: { type: integer, example: 2 }
        badgesTotal: { type: integer, example: 3 }
        checkpointsSigned: { type: integer, example: 1 }
        checkpointsTotal: { type: integer, example: 2 }
        isComplete:
          type: boolean
          description: Whether all requirements are met.
          example: false
      required: [phaseId, badgesEarned, badgesTotal, checkpointsSigned, checkpointsTotal, isComplete]

    PhaseDueDate:
      type: object
      description: Due date for a specific phase within an assignment.
      properties:
        phaseId:
          type: string
          description: The phase this due date applies to.
          example: "phs_abc123"
        dueDate:
          type: string
          format: date-time
          description: When this phase should be completed.
          example: "2025-09-15T23:59:59Z"
      required: [phaseId, dueDate]

    CheckpointCompletion:
      type: object
      description: Record of a checkpoint being signed off.
      properties:
        id:
          type: string
          description: Unique completion identifier.
          example: "chk_cmp_abc123"
        assignmentId:
          type: string
          description: Learner assignment ID.
          example: "asn_lrn_abc123"
        checkpointId:
          type: string
          description: The checkpoint that was completed.
          example: "chk_abc123"
        signedBy:
          type: string
          description: Staff user who signed off.
          example: "usr_abc123"
        signedAt: { $ref: "#/components/schemas/ISODateTime" }
        notes:
          type: string
          maxLength: 1000
          description: Optional notes about the completion.
      required: [id, assignmentId, checkpointId, signedBy, signedAt]

    CohortProgramAssignmentCreateRequest:
      type: object
      description: Payload to assign a program to a cohort.
      properties:
        programId:
          type: string
          description: Program to assign.
          example: "prg_abc123"
        phaseDueDates:
          type: array
          items: { $ref: "#/components/schemas/PhaseDueDate" }
      required: [programId]

    LearnerProgramAssignmentCreateRequest:
      type: object
      description: Payload to assign a program to a learner.
      properties:
        programId:
          type: string
          description: Program to assign.
          example: "prg_abc123"
        phaseDueDates:
          type: array
          items: { $ref: "#/components/schemas/PhaseDueDate" }
      required: [programId]

    CheckpointSignRequest:
      type: object
      description: Payload to sign off on a checkpoint.
      properties:
        notes:
          type: string
          maxLength: 1000
          description: Optional notes about the completion.

    PagedCohortProgramAssignments:
      type: object
      properties:
        meta: { $ref: "#/components/schemas/PagedMeta" }
        data:
          type: array
          items: { $ref: "#/components/schemas/CohortProgramAssignmentDetail" }
      required: [meta, data]

    PagedLearnerProgramAssignments:
      type: object
      properties:
        meta: { $ref: "#/components/schemas/PagedMeta" }
        data:
          type: array
          items: { $ref: "#/components/schemas/LearnerProgramAssignmentDetail" }
      required: [meta, data]
